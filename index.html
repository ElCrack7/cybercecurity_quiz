<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Quiz z cyberbezpiecze≈Ñstwa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0b1b2b;
      color: #f5f5f5;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .container {
      max-width: 800px;
      width: 100%;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 10px;
    }

    .card {
      background: #15263a;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-top: 10px;
      margin-bottom: 4px;
      font-weight: bold;
    }

    select, button {
      padding: 8px 12px;
      border-radius: 6px;
      border: none;
      font-size: 14px;
      margin-bottom: 10px;
    }

    button {
      background: #1e90ff;
      color: white;
      cursor: pointer;
    }

    button:disabled {
      background: #555;
      cursor: not-allowed;
    }

    .answers {
      margin-top: 10px;
      display: grid;
      gap: 8px;
    }

    .answer-btn {
      text-align: left;
      background: #1d3552;
    }

    .answer-btn.correct {
      background: #2c7a3f;
    }

    .answer-btn.wrong {
      background: #b22222;
    }

    .hidden {
      display: none;
    }

    .score-box {
      margin-top: 10px;
      font-weight: bold;
    }

    .tag {
      display: inline-block;
      background: #233752;
      padding: 2px 8px;
      border-radius: 6px;
      font-size: 12px;
      margin-right: 5px;
    }

    .explanation {
      margin-top: 10px;
      font-size: 14px;
      background: #101c2b;
      padding: 10px;
      border-radius: 8px;
      white-space: pre-line;
    }

    .reward {
      font-size: 18px;
      margin-top: 10px;
    }

    .small {
      font-size: 12px;
      opacity: 0.8;
    }
  .police-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
    padding: 12px 16px;
    border-radius: 10px;
    background: linear-gradient(135deg, #0f2545, #163b70);
    box-shadow: 0 0 10px rgba(0,0,0,0.4);
  }

  .police-header-text {
    display: flex;
    flex-direction: column;
  }

  .police-header-title {
    font-size: 18px;
    font-weight: bold;
    letter-spacing: 0.03em;
    text-transform: uppercase;
  }

  .police-header-subtitle {
    font-size: 13px;
    opacity: 0.9;
  }

  .police-icon {
    width: 42px;
    height: 42px;
    flex-shrink: 0;
  }

  .police-tape {
    margin-top: 10px;
    padding: 6px 10px;
    border-radius: 8px;
    background-image: repeating-linear-gradient(
      -45deg,
      #ffd600,
      #ffd600 10px,
      #001c40 10px,
      #001c40 20px
    );
    color: #001c40;
    font-size: 11px;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    text-align: center;
  }

  </style>
</head>
<body>
<div class="container">
<!-- NAG≈Å√ìWEK POLICYJNY -->
  <div class="police-header">
    <!-- Prosta ikona tarczy z gwiazdƒÖ (SVG, bez plik√≥w zewnƒôtrznych) -->
    <svg class="police-icon" viewBox="0 0 64 64">
      <defs>
        <linearGradient id="shieldGradient" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stop-color="#2f5daa"/>
          <stop offset="100%" stop-color="#182c54"/>
        </linearGradient>
      </defs>
      <path d="M32 4
               C26 10,18 11,12 11
               C12 38,21 50,32 60
               C43 50,52 38,52 11
               C46 11,38 10,32 4Z"
            fill="url(#shieldGradient)" stroke="#d7e6ff" stroke-width="2"/>
      <polygon points="32,16 35,24 44,24 36.5,29.5 39.5,38 32,32.5 24.5,38 27.5,29.5 20,24 29,24"
               fill="#ffd600" stroke="#f3f3f3" stroke-width="1"/>
    </svg>

    <div class="police-header-text">
      <div class="police-header-title">Misja: CyberBezpiecze≈Ñstwo</div>
      <div class="police-header-subtitle">Modu≈Ç profilaktyczny ‚Äì wersja demonstracyjna</div>
    </div>
  </div>
  <h1>Quiz z cyberbezpiecze≈Ñstwa</h1>

  <!-- Panel startowy -->
  <div class="card" id="start-screen">
    <p>Wybierz poziom trudno≈õci i rozpocznij misjƒô bezpiecze≈Ñstwa w sieci üíªüõ°Ô∏è</p>

    <label for="difficulty">Poziom trudno≈õci:</label>
    <select id="difficulty">
      <option value="latwy">≈Åatwy</option>
      <option value="sredni">≈öredni</option>
      <option value="trudny">Trudny</option>
      <option value="mix">MIX (r√≥≈ºne poziomy)</option>
    </select>

    <label for="question-count">Liczba pyta≈Ñ w jednej rozgrywce:</label>
    <select id="question-count">
      <option value="5">5</option>
      <option value="10" selected>10</option>
    </select>

    <p class="small">
      Pytania sƒÖ wczytywane z arkusza Google (CSV), kt√≥ry mo≈ºna ≈Çatwo aktualizowaƒá bez znajomo≈õci programowania.
    </p>

    <button id="start-btn" disabled>Start gry</button>
    <p id="load-status" class="small"></p>
  </div>

  <!-- Panel pytania -->
  <div class="card hidden" id="quiz-screen">
    <div id="question-header">
      <span class="tag" id="question-number-tag"></span>
      <span class="tag" id="difficulty-tag"></span>
    </div>
    <h2 id="question-text"></h2>

    <div class="answers" id="answers-container"></div>

    <div id="explanation" class="explanation hidden"></div>

    <div class="score-box">
      Wynik: <span id="score">0</span> pkt
    </div>

    <button id="next-btn" class="hidden">Nastƒôpne pytanie</button>
  </div>

  <!-- Panel ko≈Ñcowy -->
  <div class="card hidden" id="end-screen">
    <h2>Koniec gry</h2>
    <p>Tw√≥j wynik: <span id="final-score"></span> punkt√≥w.</p>
    <p id="reward-text" class="reward"></p>
    <button id="restart-btn">Zagraj ponownie</button>
  </div>
</div>

<script>
  // üîó 1) TU WKLEJ LINK DO CSV Z GOOGLE SHEETS
  // Przyk≈Çad:
  // const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/ID/export?format=csv";
  const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/1v9U-jsyK9kfX7Pwo7TTtG8-LoJ3f40XbFE081mGwY0c/export?format=csv&gid=0";

  const startScreen = document.getElementById('start-screen');
  const quizScreen = document.getElementById('quiz-screen');
  const endScreen = document.getElementById('end-screen');

  const startBtn = document.getElementById('start-btn');
  const nextBtn = document.getElementById('next-btn');
  const restartBtn = document.getElementById('restart-btn');

  const difficultySelect = document.getElementById('difficulty');
  const questionCountSelect = document.getElementById('question-count');

  const questionNumberTag = document.getElementById('question-number-tag');
  const difficultyTag = document.getElementById('difficulty-tag');
  const questionText = document.getElementById('question-text');
  const answersContainer = document.getElementById('answers-container');
  const explanationBox = document.getElementById('explanation');
  const scoreSpan = document.getElementById('score');
  const finalScoreSpan = document.getElementById('final-score');
  const rewardText = document.getElementById('reward-text');
  const loadStatus = document.getElementById('load-status');

  let allQuestions = [];
  let currentQuestions = [];
  let currentIndex = 0;
  let score = 0;
  let answered = false;

  // üß† Funkcje pomocnicze

  function difficultyLabel(diff) {
    switch (diff) {
      case 'latwy': return '≈Åatwy';
      case 'sredni': return '≈öredni';
      case 'trudny': return 'Trudny';
      default: return diff;
    }
  }

  function difficultyPoints(diff) {
    switch (diff) {
      case 'latwy': return 1;
      case 'sredni': return 2;
      case 'trudny': return 3;
      default: return 1;
    }
  }

  function shuffle(array) {
    const arr = [...array];
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  // üîç Prosty parser CSV (zak≈Çadamy brak przecink√≥w w tre≈õci)
  function parseCSV(text) {
    const rows = text.trim().split('\n');

    if (rows.length < 2) return [];

    const header = rows[0].split(',').map(h => h.trim());
    const dataRows = rows.slice(1);

    const getIndex = (name) => header.indexOf(name);

    const idxId = getIndex('id');
    const idxCategory = getIndex('category');
    const idxDifficulty = getIndex('difficulty');
    const idxQuestion = getIndex('question');
    const idxAns1 = getIndex('ans1');
    const idxAns2 = getIndex('ans2');
    const idxAns3 = getIndex('ans3');
    const idxAns4 = getIndex('ans4');
    const idxCorrect = getIndex('correctIndex');
    const idxExplanation = getIndex('explanation');

    return dataRows.map(row => {
      const cols = row.split(','); // prosto: brak przecink√≥w w ≈õrodku p√≥l
      return {
        id: idxId >= 0 ? Number(cols[idxId]) : null,
        category: idxCategory >= 0 ? (cols[idxCategory] || '').trim() : '',
        difficulty: idxDifficulty >= 0 ? (cols[idxDifficulty] || '').trim() : '',
        question: idxQuestion >= 0 ? (cols[idxQuestion] || '').trim() : '',
        answers: [
          idxAns1 >= 0 ? (cols[idxAns1] || '').trim() : '',
          idxAns2 >= 0 ? (cols[idxAns2] || '').trim() : '',
          idxAns3 >= 0 ? (cols[idxAns3] || '').trim() : '',
          idxAns4 >= 0 ? (cols[idxAns4] || '').trim() : '',
        ],
        correctIndex: idxCorrect >= 0 ? Number(cols[idxCorrect]) : 0,
        explanation: idxExplanation >= 0 ? (cols[idxExplanation] || '').trim() : ''
      };
    });
  }

  // üåê Wczytanie pyta≈Ñ z Google Sheets (CSV)
  async function loadQuestions() {
    loadStatus.textContent = "≈Åadowanie pyta≈Ñ z arkusza...";
    startBtn.disabled = true;

    try {
      if (!SHEET_CSV_URL || SHEET_CSV_URL.includes("WSTAW_TUTAJ")) {
        throw new Error("Nie ustawiono adresu SHEET_CSV_URL.");
      }

      const response = await fetch(SHEET_CSV_URL);
      if (!response.ok) {
        throw new Error('B≈ÇƒÖd wczytywania CSV z Google Sheets');
      }

      const csvText = await response.text();
      const parsed = parseCSV(csvText);

      // filtrujemy tylko kategoriƒô "cyber"
      allQuestions = parsed.filter(q => q.category === 'cyber');

      if (allQuestions.length === 0) {
        loadStatus.textContent = "Brak pyta≈Ñ w kategorii 'cyber' w arkuszu.";
        return;
      }

      loadStatus.textContent = `Za≈Çadowano ${allQuestions.length} pyta≈Ñ z arkusza. Mo≈ºesz rozpoczƒÖƒá grƒô.`;
      startBtn.disabled = false;

    } catch (error) {
      console.error(error);
      loadStatus.textContent = "Nie uda≈Ço siƒô wczytaƒá pyta≈Ñ z arkusza. Sprawd≈∫ link do CSV lub ustawienia udostƒôpniania.";
      startBtn.disabled = true;
    }
  }

  // ‚ñ∂Ô∏è Start gry
  function startGame() {
    const difficulty = difficultySelect.value;
    const questionCount = parseInt(questionCountSelect.value, 10);

    let filtered = [];
    if (difficulty === 'mix') {
      filtered = allQuestions;
    } else {
      filtered = allQuestions.filter(q => q.difficulty === difficulty);
    }

    if (filtered.length === 0) {
      alert('Brak pyta≈Ñ dla wybranego poziomu trudno≈õci w arkuszu. Dodaj je w Google Sheets.');
      return;
    }

    currentQuestions = shuffle(filtered).slice(0, questionCount);
    currentIndex = 0;
    score = 0;
    scoreSpan.textContent = score;

    startScreen.classList.add('hidden');
    endScreen.classList.add('hidden');
    quizScreen.classList.remove('hidden');

    showQuestion();
  }

  // ‚ùì Wy≈õwietlanie pytania
  function showQuestion() {
    answered = false;
    explanationBox.classList.add('hidden');
    explanationBox.textContent = '';
    nextBtn.classList.add('hidden');

    const q = currentQuestions[currentIndex];
    questionNumberTag.textContent = `Pytanie ${currentIndex + 1} / ${currentQuestions.length}`;
    difficultyTag.textContent = `Poziom: ${difficultyLabel(q.difficulty)}`;
    questionText.textContent = q.question;

    answersContainer.innerHTML = '';
    q.answers.forEach((answerText, index) => {
      const btn = document.createElement('button');
      btn.classList.add('answer-btn');
      btn.textContent = answerText;
      btn.addEventListener('click', () => handleAnswerClick(index));
      answersContainer.appendChild(btn);
    });
  }

  // ‚úÖ/‚ùå Obs≈Çuga odpowiedzi
  function handleAnswerClick(selectedIndex) {
  if (answered) return;
  answered = true;

  const correctSound = document.getElementById("sound-correct");
  const wrongSound = document.getElementById("sound-wrong");

  const q = currentQuestions[currentIndex];
  const buttons = Array.from(document.getElementsByClassName('answer-btn'));

  buttons.forEach((btn, index) => {
    btn.disabled = true;
    if (index === q.correctIndex) {
      btn.classList.add('correct');
    }
    if (index === selectedIndex && index !== q.correctIndex) {
      btn.classList.add('wrong');
    }
  });

  if (selectedIndex === q.correctIndex) {
    correctSound.play();
    const pts = difficultyPoints(q.difficulty);
    score += pts;
    scoreSpan.textContent = score;
    explanationBox.textContent = `‚úÖ Dobrze! (+${pts} pkt)\n${q.explanation || ''}`;
  } else {
    wrongSound.play();
    explanationBox.textContent = `‚ùå Niepoprawnie. Prawid≈Çowa odpowied≈∫: "${q.answers[q.correctIndex]}".\n` + (q.explanation || '');
  }

  explanationBox.classList.remove('hidden');
  nextBtn.classList.remove('hidden');
}

  // üèÅ Koniec gry
  function endGame() {
    quizScreen.classList.add('hidden');
    endScreen.classList.remove('hidden');

    finalScoreSpan.textContent = score;

    const maxPossible = currentQuestions.reduce((sum, q) => sum + difficultyPoints(q.difficulty), 0);
    const ratio = score / maxPossible;

    if (ratio >= 0.8) {
      rewardText.textContent = "üéñ Poziom: Cyber Stra≈ºnik ‚Äì ≈õwietna znajomo≈õƒá zasad bezpiecze≈Ñstwa!";
    } else if (ratio >= 0.5) {
      rewardText.textContent = "üèÖ Poziom: Cyber Patrol ‚Äì jest dobrze, ale mo≈ºesz jeszcze poprawiƒá swoje zabezpieczenia.";
    } else {
      rewardText.textContent = "üîç Poziom: Cyber Rekrut ‚Äì potrzebujesz wiƒôcej treningu, ale to dobry poczƒÖtek.";
    }

    startScreen.classList.add('hidden');
  }

  // üß∑ Obs≈Çuga przycisk√≥w
  startBtn.addEventListener('click', startGame);

  nextBtn.addEventListener('click', () => {
    currentIndex++;
    if (currentIndex >= currentQuestions.length) {
      endGame();
    } else {
      showQuestion();
    }
  });

  restartBtn.addEventListener('click', () => {
    endScreen.classList.add('hidden');
    startScreen.classList.remove('hidden');
  });

  // üöÄ Na start: wczytaj pytania z arkusza
  loadQuestions();
</script>
<audio id="sound-correct" src="correct.wav"></audio>
<audio id="sound-wrong" src="wrong.wav"></audio>
<audio id="sound-next" src="next.wav"></audio>
</body>
</html>
